!function(){var e;window.tytoConfig=e={autoSave:!0,helpModalId:"tytoHelpModal",infoModalId:"tytoInfoModal",DOMId:"barn",DOMElementSelector:".barn",emailSubject:"my current items",emailRecipient:"you@me.com",saveFilename:"barn",maxColumns:10,columns:[{title:"A column",items:[{content:"I'm your first item, and just like all items I am draggable between columns by using the move icon.",collapsed:!1,title:"Item header."},{collapsed:!1,content:"there are actions available above for you to add columns and items, export your board, load a board etc.",title:"Click to edit me!"}]},{title:"Another column",items:[{collapsed:!1,content:"You can also collapse/expand items by clicking the plus/minus icon.",title:"collapsible"},{collapsed:!1,content:"If you want to just get started you can wipe the board using the menu above.",title:"Wipe"}]},{title:"Click me to edit",items:[{collapsed:!1,title:"edit me",content:"you can click an item to enter edit mode and edit it."},{collapsed:!0,content:"I was collapsed.",title:"collapsed"}]},{title:"Done",items:[{content:"You can also drag columns to resort their ordering using the move icon at the top next to the remove icon."},{title:"saving",content:"As long as you've accepted the use of cookies all your tasks are saved in the browser so no worries about losing everything.",collapsed:!0}]}]};var t;window.tyto=t=function(){var n;return this instanceof t?(n=this,n.config=void 0!==window.localStorage.tyto?JSON.parse(window.localStorage.tyto):e,n.modals={},n._autoSave=n.config.autoSave,$.when(n._loadTemplates()).done(function(){return n._init()}),n):new t},t.prototype._init=function(){return t=this,t._buildBarn(),t._bindActions(),t},t.prototype._loadTemplates=function(){return t=this,$.when($.get("templates/column.html"),$.get("templates/item.html"),$.get("templates/email.html")).done(function(e,n,o,i){return t.columnHtml=e[0],t.itemHtml=n[0],t.emailHtml=o[0]})},t.prototype._buildBarn=function(){var e,n;if(t=this,t.undo={},e=t.config,void 0!==e.DOMElementSelector||void 0!==e.DOMId){if(t.element=$(void 0!==e.DOMId?"#"+e.DOMId:e.DOMElementSelector),t.element.attr("data-tyto","true"),t.element.find('[data-action="addcolumn"]').on("click",function(e){return t.addColumn()}),window.localStorage&&window.localStorage.tyto?t._setUpLocalStorageAutoSave():window.localStorage&&$("#cookie-banner").removeClass("hide").find('[data-action="cookie-close"]').on("click",function(e){return t._setUpLocalStorageAutoSave(),$(".cookie-banner").remove()}),(t._autoSave===!1||void 0===t._autoSave)&&$('.actions [data-action="toggleautosave"] i').toggleClass("fa-check-square-o fa-square-o"),void 0!==e.columns&&e.columns.length>0){for(t.element.find(".column").remove(),n=0;n<e.columns.length;)t._createColumn(e.columns[n]),n++;t._resizeColumns(),t.element.find(".tyto-item").length>0&&$.each(t.element.find(".tyto-item"),function(e,n){return t._binditemEvents($(n))})}$('[data-action="undolast"]').removeClass("btn-info").addClass("btn-disabled").attr("disabled",!0),t.element.sortable({connectWith:".column",handle:".column-mover",placeholder:"column-placeholder",axis:"x",containment:"#barn",opacity:.8,start:function(e,n){var o;return t._movedItem=$(n.item),t._movedItemOrigin=$(e.currentTarget),o=Array.prototype.slice.call(t.element.children(".column")),t._movedItemIndex=o.indexOf($(n.item)[0])},stop:function(e,n){var o,i;return o=Array.prototype.slice.call(t.element.children(".column")),i=o.indexOf($(n.item)[0]),i<t._movedItemIndex&&(t._movedItemIndex+=1),t.element.trigger({type:"tyto:action",name:"move-column",DOMcolumn:t._movedItem,itemIndex:t._movedItemIndex}),t.notify("column moved",2e3)}},t=this)}return t},t.prototype._createColumn=function(e){var n,o;return t=this,o=Handlebars.compile(t.columnHtml),Handlebars.registerPartial("item",t.itemHtml),n=$(o(e)),this.element.append(n),this._bindColumnEvents(n),t.element.trigger({type:"tyto:action",name:"add-column",DOMcolumn:n,DOMitem:void 0})},t.prototype._setUpLocalStorageAutoSave=function(){var e,n;return t=this,e=void 0,n=function(n,o){return e&&clearTimeout(e),e=setTimeout(function(){return n.apply(),t},o)},$("body").on("tyto:action",function(e){return t._autoSave?n(function(){return t.saveBarn()},5e3):void 0}),t},t.prototype._bindColumnEvents=function(e){return t=this,e.find(".column-title").on("keydown",function(e){var t;return t=this,13===e.keyCode||13===e.charCode||27===e.keyCode||27===e.charCode?t.blur():void 0}),e.find(".column-title").on("click",function(e){return t._preEditItemContent=this.innerHTML.toString().trim()}),e.find(".column-title").on("blur",function(n){return t.element.trigger({type:"tyto:action",name:"edit-column-title",DOMcolumn:e,content:t._preEditItemContent})}),e.find(".items").sortable({connectWith:".items",handle:".item-mover",placeholder:"item-placeholder",containment:"#barn",opacity:.8,revert:!0,start:function(n,o){var i;return t._movedItem=$(o.item),t._movedItemOrigin=$(n.currentTarget),i=Array.prototype.slice.call(e.find(".items").children(".tyto-item")),t._movedItemIndex=i.indexOf($(o.item)[0])},stop:function(e,n){return t.element.trigger({type:"tyto:action",name:"move-item",DOMcolumn:t._movedItemOrigin,DOMitem:t._movedItem,itemIndex:t._movedItemIndex}),t.notify("item moved",2e3)}}),e.find('[data-action="removecolumn"]').on("click",function(n){return t.removeColumn(e)}),e.find('[data-action="additem"]').on("click",function(n){return t.addItem(e)}),t},t.prototype.undoLast=function(){if(t=this,t.undo){switch(t.undo.action){case"add-column":t.undo.column.remove(),t._resizeColumns();break;case"add-item":t.undo.item.remove();break;case"remove-column":t.undo.columnIndex>t.element.find(".column").length-1?t.element.append(t.undo.column):$(t.element.find(".column")[t.undo.columnIndex]).before(t.undo.column),t._bindColumnEvents(t.undo.column),$.each(t.undo.column.find("[data-tyto-item]"),function(){return t._binditemEvents($(this))}),t._resizeColumns();break;case"remove-item":t.undo.itemIndex>t.undo.column.find("[data-tyto-item]").length-1?t.undo.column.find(".items").append(t.undo.item):$(t.element.find(t.undo.column).find("[data-tyto-item]")[t.undo.itemIndex]).before(t.undo.item),t._binditemEvents(t.undo.item);break;case"move-item":0===t.undo.itemIndex||t.undo.itemIndex===t.undo.column.children(".tyto-item").length?t.undo.column.append(t.undo.item):$(t.undo.column.children(".tyto-item")[t.undo.itemIndex]).before(t.undo.item);break;case"move-column":$(t.element.children(".column")[t.undo.itemIndex]).before(t.undo.column);break;case"edit-item-title":t.undo.item.find(".tyto-item-title")[0].innerHTML=t.undo.editContent;break;case"edit-item-content":t.undo.item.find(".tyto-item-content")[0].innerHTML=t.undo.editContent;break;case"edit-column-title":t.undo.column.find(".column-title")[0].innerHTML=t.undo.editContent;break;case"wipe-board":t.element.append(t.undo.item),$.each(t.element.find(".tyto-item"),function(e,n){return t._binditemEvents($(n))}),$.each(t.element.find(".column"),function(e,n){return t._bindColumnEvents($(n))});break;default:console.log("tyto: no luck, you don't seem to be able to undo that")}return $('[data-action="undolast"]').removeClass("btn-info").addClass("btn-disabled").attr("disabled",!0),t.notify("undone",2e3)}},t.prototype.addColumn=function(){return t=this,t.element.find(".column").length<t.config.maxColumns?(t._createColumn(),t._resizeColumns(),t.notify("column added",2e3)):alert("whoah, it's getting busy and you've reached the maximum amount of\ncolumns. You can however increase the amount of maximum columns via the\nconfig.")},t.prototype.removeColumn=function(e){var n,o;return null==e&&(e=this.element.find(".column").last()),t=this,n=function(){var t;return t=void 0,$.each($(".column"),function(n,o){return e[0]===o?(t=n,!1):void 0}),t},o=function(){var n;return n=Array.prototype.slice.call(e.parent("[data-tyto]").children(".column")),t.element.trigger({type:"tyto:action",name:"remove-column",DOMitem:void 0,DOMcolumn:e,columnIndex:n.indexOf(e[0])}),e.remove(),t._resizeColumns()},e.find(".tyto-item").length>0?confirm("are you sure you want to remove this column?\ndoing so will lose all items within it.")&&(o(),t.notify("column removed",2e3)):(o(),t.notify("column removed",2e3)),t},t.prototype.addItem=function(e,t){return null==e&&(e=this.element.find(".column").first()),this._createItem(e,t),this.notify("item added",2e3)},t.prototype._createItem=function(e,n){var o,i;return t=this,i=Handlebars.compile(t.itemHtml),o=$(i({})),t._binditemEvents(o),e.find(".tyto-item-holder .items").append(o),t.element.trigger({type:"tyto:action",name:"add-item",DOMitem:o,DOMcolumn:e})},t.prototype._binditemEvents=function(e){return t=this,e.find(".close").on("click",function(n){var o;return confirm("are you sure you want to remove this item?")?(o=Array.prototype.slice.call(e.parent(".items").children()),t.element.trigger({type:"tyto:action",name:"remove-item",DOMitem:e,DOMcolumn:e.parents(".column"),columnIndex:void 0,itemIndex:o.indexOf(e[0])}),e.remove(),t.notify("item removed",2e3)):void 0}),e.find("i.collapser").on("click",function(e){var t;return t=$(this),t.toggleClass("fa-minus fa-plus"),t.closest(".tyto-item").find(".tyto-item-content").toggle()}),e.find(".tyto-item-title, .tyto-item-content").on("keydown",function(e){var t;return t=this,27===e.keyCode||27===e.charCode?t.blur():void 0}),e.find(".tyto-item-title").on("click",function(e){return t._preEditItemContent=this.innerHTML.toString().trim()}),e.find(".tyto-item-title").on("blur",function(n){return t.element.trigger({type:"tyto:action",name:"edit-item-title",DOMitem:e,content:t._preEditItemContent}),t.notify("item title edited",2e3)}),e.find(".tyto-item-content").on("click",function(e){return t._preEditItemContent=this.innerHTML.toString().trim()}),e.find(".tyto-item-content").on("blur",function(n){return t.element.trigger({type:"tyto:action",name:"edit-item-content",DOMitem:e,content:t._preEditItemContent}),t.notify("item content edited",2e3)})},t.prototype.saveBarn=function(e){return window.localStorage.setItem("tyto",JSON.stringify(t._createBarnJSON())),this.notify("board saved",2e3)},t.prototype.deleteSave=function(){return window.localStorage.removeItem("tyto"),this.notify("save deleted",2e3)},t.prototype._bindActions=function(){var e,n;return t=this,n={additem:"addItem",addcolumn:"addColumn",exportbarn:"exportBarn",loadbarn:"loadBarn",emailbarn:"emailBarn",helpbarn:"showHelp",infobarn:"showInfo",undolast:"undoLast",savebarn:"saveBarn",deletesave:"deleteSave",wipeboard:"wipeBoard",toggleautosave:"toggleAutoSave"},e="",$(".actions").on("click","[data-action]",function(o){return e=o.target.dataset.action,t[n[e]]()}),$("body").on("tyto:action",function(e){return t.undo.action=e.name,t.undo.column=e.DOMcolumn,t.undo.item=e.DOMitem,t.undo.columnIndex=e.columnIndex,t.undo.itemIndex=e.itemIndex,t.undo.editContent=e.content,$('[data-action="undolast"]').removeAttr("disabled").removeClass("btn-disabled").addClass("btn-default")})},t.prototype.wipeBoard=function(){var e;return confirm("are you really sure you wish to wipe your entire board?")?(e=t.element[0].innerHTML,t.element[0].innerHTML="",t.element.trigger({type:"tyto:action",name:"wipe-board",DOMitem:$(e)}),t.notify("board wiped",2e3)):void 0},t.prototype.toggleAutoSave=function(){return $('[data-action="toggleautosave"] i').toggleClass("fa-check-square-o fa-square-o"),t._autoSave=!t._autoSave,t._autoSave?t.notify("auto-save: ON",2e3):t.notify("auto-save: OFF",2e3),window.localStorage.setItem("tyto",JSON.stringify(t._createBarnJSON()))},t.prototype._resizeColumns=function(){var e;return t=this,t.element.find(".column").length>0?(e=100/t.element.find(".column").length,t.element.find(".column").css({width:e+"%"})):void 0},t.prototype._createBarnJSON=function(){var e,n;return t=this,n={autoSave:t._autoSave,helpModalId:t.config.helpModalId,infoModalId:t.config.infoModalId,emailSubject:t.config.emailSubject,emailRecipient:t.config.emailRecipient,DOMId:t.config.DOMId,DOMElementSelector:t.config.DOMElementSelector,saveFilename:t.config.saveFilename,maxColumns:t.config.maxColumns,columns:[]},e=t.element.find(".column"),$.each(e,function(e,t){var o,i,a,r;return r=new RegExp("<br>","g"),o=$(t).find(".column-title")[0].innerHTML.toString().replace(r,""),a=[],i=$(t).find(".tyto-item"),$.each(i,function(e,t){var n;return n=-1!==t.querySelector(".action-icons .collapser").className.indexOf("plus")?!0:!1,a.push({content:t.querySelector(".tyto-item-content").innerHTML.toString().trim(),title:t.querySelector(".tyto-item-title").innerHTML.toString().trim(),collapsed:n})}),n.columns.push({title:o,items:a})}),n},t.prototype._loadBarnJSON=function(e){return t=this,t._buildBarn(e)},t.prototype._escapes={"#":"@tyto-hash"},t.prototype._encodeJSON=function(e){var n,o;if(t=this,void 0!==e)for(n in t._escapes)o=new RegExp(n,"g"),e=e.replace(o,t._escapes[n]);return e},t.prototype._decodeJSON=function(e){var n,o;if(t=this,void 0!==e)for(n in t._escapes)o=new RegExp(t._escapes[n],"g"),e=e.replace(o,n);return e},t.prototype.exportBarn=function(){var e,n,o;return t=this,o=$("#savetyto"),n=void 0!==t.config.saveFilename?t.config.saveFilename+".json":"itemboard.json",e="data:text/plain,"+t._encodeJSON(JSON.stringify(t._createBarnJSON())),o[0].setAttribute("download",n),o[0].setAttribute("href",e),o[0].click()},t.prototype.loadBarn=function(){var e;return t=this,e=$("#tytofiles"),window.File&&window.FileReader&&window.FileList&&window.Blob?e[0].click():alert("tyto: the file APIs are not fully supported in your browser"),e.on("change",function(e){var n,o;return n=e.target.files[0],n.type.match("application/json")||n.name.indexOf(!0)?(o=new FileReader,o.onloadend=function(e){var n;return n=JSON.parse(t._decodeJSON(this.result)),void 0===n.columns||void 0===n.DOMId&&void 0===n.DOMElementSelector?alert("tyto: incorrect json"):t._loadBarnJSON(n)},o.readAsText(n)):alert("tyto: only load a valid itemboard json file")})},t.prototype._getEmailContent=function(){var e,n,o,i,a;return t=this,n="",o=t._createBarnJSON(),a=Handlebars.compile(t.emailHtml),e=$(a(o)),i=new RegExp("&lt;br&gt;","gi"),"Here are your current items."===e.html().trim()?"You have no items on your plate so go grab a drink! :)":e.html().replace(i,"").trim()},t.prototype.emailBarn=function(){var e,n,o,i,a,r;return t=this,o="mailto:",a=t.config.emailRecipient?t.config.emailRecipient:"someone@somewhere.com",n=new Date,r=t.config.emailSubject?t.config.emailSubject:"items as of "+n.toString(),e=t._getEmailContent(),e=encodeURIComponent(e),i=o+a+"?subject="+encodeURIComponent(r.trim())+"&body="+e,$("#tytoemail").attr("href",i),$("#tytoemail")[0].click()},t.prototype.notify=function(e,t){var n;return n=$('<div class= "tyto-notification notify" data-tyto-notify=" '+t/1e3+' ">'+e+"</div>"),$("body").prepend(n),setTimeout(function(){return n.remove()},t)},t.prototype.showHelp=function(){return t=this,t.config.helpModalId?(t.modals.helpModal=$("#"+t.config.helpModalId),t.modals.helpModal.modal()):void 0},t.prototype.showInfo=function(){return t=this,t.config.infoModalId?(t.modals.infoModal=$("#"+t.config.infoModalId),t.modals.infoModal.modal()):void 0}}();